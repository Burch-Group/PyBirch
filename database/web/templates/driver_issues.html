{% extends "base.html" %}

{% block title %}Issues - {{ definition.display_name }} - PyBirch Database{% endblock %}

{% block content %}
<div class="list-page">
    <div class="page-header">
        <div class="breadcrumb">
            <a href="{{ url_for('main.drivers') }}">Drivers</a> / 
            <a href="{{ url_for('main.driver_detail', definition_id=definition.id) }}">{{ definition.display_name }}</a> / 
            Issues
        </div>
    </div>
    
    <div class="page-title-row">
        <h1>Issues for {{ definition.display_name }}</h1>
        <a href="{{ url_for('main.driver_issue_new', definition_id=definition.id) }}" class="btn btn-primary">+ Report Issue</a>
    </div>
    
    <div class="filters">
        <form method="GET" class="filter-form">
            <select name="status" class="filter-select">
                <option value="">All Status</option>
                <option value="open" {% if status == 'open' %}selected{% endif %}>Open</option>
                <option value="in_progress" {% if status == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="resolved" {% if status == 'resolved' %}selected{% endif %}>Resolved</option>
                <option value="closed" {% if status == 'closed' %}selected{% endif %}>Closed</option>
                <option value="wont_fix" {% if status == 'wont_fix' %}selected{% endif %}>Won't Fix</option>
            </select>
            <select name="priority" class="filter-select">
                <option value="">All Priorities</option>
                <option value="critical" {% if priority == 'critical' %}selected{% endif %}>Critical</option>
                <option value="high" {% if priority == 'high' %}selected{% endif %}>High</option>
                <option value="medium" {% if priority == 'medium' %}selected{% endif %}>Medium</option>
                <option value="low" {% if priority == 'low' %}selected{% endif %}>Low</option>
            </select>
            <button type="submit" class="btn btn-secondary">Filter</button>
            {% if status or priority %}
                <a href="{{ url_for('main.driver_issues', definition_id=definition.id) }}" class="btn btn-link">Clear</a>
            {% endif %}
        </form>
    </div>
    
    <p class="result-count">{{ total }} issue(s) found</p>
    
    {% if issues %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Assignee</th>
                    <th>Affected Version</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for issue in issues %}
                <tr>
                    <td><a href="{{ url_for('main.driver_issue_detail', definition_id=definition.id, issue_id=issue.id) }}">{{ issue.title }}</a></td>
                    <td>{{ issue.category }}</td>
                    <td><span class="priority-badge priority-{{ issue.priority }}">{{ issue.priority }}</span></td>
                    <td><span class="status-badge status-{{ issue.status }}">{{ issue.status }}</span></td>
                    <td>{{ issue.assignee_name or '-' }}</td>
                    <td>{% if issue.affected_version %}v{{ issue.affected_version }}{% else %}-{% endif %}</td>
                    <td>{{ issue.created_at[:10] if issue.created_at else '-' }}</td>
                    <td>
                        <a href="{{ url_for('main.driver_issue_detail', definition_id=definition.id, issue_id=issue.id) }}" class="btn btn-sm">View</a>
                        <a href="{{ url_for('main.driver_issue_edit', definition_id=definition.id, issue_id=issue.id) }}" class="btn btn-sm btn-secondary">Edit</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if total_pages > 1 %}
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url_for('main.driver_issues', definition_id=definition.id, page=page-1, status=status, priority=priority) }}" class="btn btn-sm">← Previous</a>
            {% endif %}
            <span class="page-info">Page {{ page }} of {{ total_pages }}</span>
            {% if page < total_pages %}
                <a href="{{ url_for('main.driver_issues', definition_id=definition.id, page=page+1, status=status, priority=priority) }}" class="btn btn-sm">Next →</a>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <div class="empty-state">
            <p>No issues found for this driver.</p>
            <a href="{{ url_for('main.driver_issue_new', definition_id=definition.id) }}" class="btn btn-primary">Report an Issue</a>
        </div>
    {% endif %}
</div>

<style>
.page-title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}
.page-title-row h1 {
    margin: 0;
}
.priority-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 500;
}
.priority-low { background: #e3f2fd; color: #1565c0; }
.priority-medium { background: #fff3e0; color: #e65100; }
.priority-high { background: #ffebee; color: #c62828; }
.priority-critical { background: #c62828; color: white; }
</style>
{% endblock %}
