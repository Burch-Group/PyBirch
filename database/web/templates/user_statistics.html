{% extends "base.html" %}

{% block title %}My Statistics - PyBirch Database{% endblock %}

{% block content %}
<div class="stats-page">
    <div class="page-header">
        <div class="breadcrumb">
            <a href="{{ url_for('main.profile') }}">Profile</a> / Statistics
        </div>
    </div>
    
    <div class="stats-header">
        <h1>üìä My Statistics</h1>
        <p class="stats-subtitle">Your activity and contributions to PyBirch</p>
    </div>
    
    <!-- Account Summary -->
    <div class="stats-highlight-row">
        <div class="stats-highlight-card stats-highlight-primary">
            <div class="highlight-icon">üèÜ</div>
            <div class="highlight-content">
                <div class="highlight-value">{{ stats.created.total }}</div>
                <div class="highlight-label">Total Items Created</div>
            </div>
        </div>
        <div class="stats-highlight-card stats-highlight-success">
            <div class="highlight-icon">‚úÖ</div>
            <div class="highlight-content">
                <div class="highlight-value">{{ stats.issues.total_resolved }}</div>
                <div class="highlight-label">Issues Resolved</div>
            </div>
        </div>
        <div class="stats-highlight-card stats-highlight-info">
            <div class="highlight-icon">üì§</div>
            <div class="highlight-content">
                <div class="highlight-value">{{ stats.uploads.total }}</div>
                <div class="highlight-label">Files Uploaded</div>
            </div>
        </div>
        <div class="stats-highlight-card stats-highlight-secondary">
            <div class="highlight-icon">üìÖ</div>
            <div class="highlight-content">
                <div class="highlight-value">{{ stats.account.days_active }}</div>
                <div class="highlight-label">Days Active</div>
            </div>
        </div>
    </div>
    
    <!-- Main Stats Grid -->
    <div class="stats-grid-sections">
        <!-- Items Created Section -->
        <div class="stats-section">
            <h2>Items Created</h2>
            <div class="stats-mini-grid">
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.samples }}</div>
                    <div class="stat-mini-label">Samples</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.scans }}</div>
                    <div class="stat-mini-label">Scans</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.queues }}</div>
                    <div class="stat-mini-label">Queues</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.fabrication_runs }}</div>
                    <div class="stat-mini-label">Fab Runs</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.procedures }}</div>
                    <div class="stat-mini-label">Procedures</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.equipment }}</div>
                    <div class="stat-mini-label">Equipment</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.precursors }}</div>
                    <div class="stat-mini-label">Precursors</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.instruments }}</div>
                    <div class="stat-mini-label">Instruments</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.locations }}</div>
                    <div class="stat-mini-label">Locations</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.created.templates }}</div>
                    <div class="stat-mini-label">Templates</div>
                </div>
            </div>
        </div>
        
        <!-- Scan Performance Section -->
        <div class="stats-section">
            <h2>Scan Performance</h2>
            <div class="performance-stats">
                <div class="performance-main">
                    <div class="performance-circle">
                        <span class="performance-value">{{ stats.scans.success_rate }}%</span>
                        <span class="performance-label">Success Rate</span>
                    </div>
                </div>
                <div class="performance-breakdown">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Total Scans</span>
                        <span class="breakdown-value">{{ stats.scans.total }}</span>
                    </div>
                    <div class="breakdown-item breakdown-success">
                        <span class="breakdown-label">Completed</span>
                        <span class="breakdown-value">{{ stats.scans.completed }}</span>
                    </div>
                    <div class="breakdown-item breakdown-danger">
                        <span class="breakdown-label">Failed</span>
                        <span class="breakdown-value">{{ stats.scans.failed }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Fabrication Performance Section -->
        <div class="stats-section">
            <h2>Fabrication Performance</h2>
            <div class="performance-stats">
                <div class="performance-main">
                    <div class="performance-circle">
                        <span class="performance-value">{{ stats.fabrication.success_rate }}%</span>
                        <span class="performance-label">Success Rate</span>
                    </div>
                </div>
                <div class="performance-breakdown">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Total Runs</span>
                        <span class="breakdown-value">{{ stats.fabrication.total }}</span>
                    </div>
                    <div class="breakdown-item breakdown-success">
                        <span class="breakdown-label">Successful</span>
                        <span class="breakdown-value">{{ stats.fabrication.successful }}</span>
                    </div>
                    <div class="breakdown-item breakdown-danger">
                        <span class="breakdown-label">Failed</span>
                        <span class="breakdown-value">{{ stats.fabrication.failed }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Issue Tracking Section -->
        <div class="stats-section">
            <h2>Issue Tracking</h2>
            <div class="stats-mini-grid stats-mini-grid-3">
                <div class="stat-mini-card stat-card-info">
                    <div class="stat-mini-value">{{ stats.issues.created }}</div>
                    <div class="stat-mini-label">Issues Reported</div>
                </div>
                <div class="stat-mini-card stat-card-warning">
                    <div class="stat-mini-value">{{ stats.issues.assigned }}</div>
                    <div class="stat-mini-label">Assigned to Me</div>
                </div>
                <div class="stat-mini-card stat-card-success">
                    <div class="stat-mini-value">{{ stats.issues.resolved }}</div>
                    <div class="stat-mini-label">Resolved</div>
                </div>
            </div>
            <h3 class="subsection-title">Equipment Issues</h3>
            <div class="stats-mini-grid stats-mini-grid-2">
                <div class="stat-mini-card">
                    <div class="stat-mini-value">{{ stats.issues.equipment_created }}</div>
                    <div class="stat-mini-label">Reported</div>
                </div>
                <div class="stat-mini-card stat-card-success">
                    <div class="stat-mini-value">{{ stats.issues.equipment_resolved }}</div>
                    <div class="stat-mini-label">Resolved</div>
                </div>
            </div>
        </div>
        
        <!-- Uploads Section -->
        <div class="stats-section">
            <h2>Uploads</h2>
            <div class="stats-mini-grid stats-mini-grid-2">
                <div class="stat-mini-card">
                    <div class="stat-mini-icon">üñºÔ∏è</div>
                    <div class="stat-mini-value">{{ stats.uploads.images }}</div>
                    <div class="stat-mini-label">Images</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-icon">üìÑ</div>
                    <div class="stat-mini-value">{{ stats.uploads.files }}</div>
                    <div class="stat-mini-label">Files</div>
                </div>
            </div>
        </div>
        
        <!-- QR Codes Section -->
        <div class="stats-section">
            <h2><img src="{{ url_for('static', filename='images/qr-code.svg') }}" class="section-icon" alt="">QR Codes</h2>
            <div class="qr-stat-highlight">
                <div class="qr-stat-icon">
                    <img src="{{ url_for('static', filename='images/qr-code.svg') }}" alt="QR Code">
                </div>
                <div class="qr-stat-content">
                    <div class="qr-stat-value">{{ stats.qr_codes.scanned }}</div>
                    <div class="qr-stat-label">QR Codes Scanned</div>
                </div>
            </div>
        </div>
        
        <!-- Memberships Section -->
        <div class="stats-section">
            <h2>Memberships & Ownership</h2>
            <div class="stats-mini-grid stats-mini-grid-2">
                <div class="stat-mini-card">
                    <div class="stat-mini-icon">üè¢</div>
                    <div class="stat-mini-value">{{ stats.memberships.labs }}</div>
                    <div class="stat-mini-label">Labs</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-icon">üìÇ</div>
                    <div class="stat-mini-value">{{ stats.memberships.projects }}</div>
                    <div class="stat-mini-label">Projects</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-icon">üîß</div>
                    <div class="stat-mini-value">{{ stats.memberships.equipment_owned }}</div>
                    <div class="stat-mini-label">Equipment Owned</div>
                </div>
                <div class="stat-mini-card">
                    <div class="stat-mini-icon">üìå</div>
                    <div class="stat-mini-value">{{ stats.memberships.pinned_items }}</div>
                    <div class="stat-mini-label">Pinned Items</div>
                </div>
            </div>
        </div>
        
        <!-- Recent Activity Section -->
        <div class="stats-section">
            <h2>Recent Activity <span class="section-badge">Last 30 Days</span></h2>
            <div class="stats-mini-grid stats-mini-grid-3">
                <div class="stat-mini-card stat-card-hot">
                    <div class="stat-mini-value">{{ stats.recent.samples }}</div>
                    <div class="stat-mini-label">Samples</div>
                </div>
                <div class="stat-mini-card stat-card-hot">
                    <div class="stat-mini-value">{{ stats.recent.scans }}</div>
                    <div class="stat-mini-label">Scans</div>
                </div>
                <div class="stat-mini-card stat-card-hot">
                    <div class="stat-mini-value">{{ stats.recent.fabrication_runs }}</div>
                    <div class="stat-mini-label">Fab Runs</div>
                </div>
            </div>
        </div>
        
        <!-- Fun Stats Section -->
        <div class="stats-section stats-section-fun">
            <h2>Fun Stats</h2>
            <div class="fun-stats-grid">
                <div class="fun-stat-card">
                    <div class="fun-stat-icon">üñ•Ô∏è</div>
                    <div class="fun-stat-content">
                        <div class="fun-stat-value">~{{ stats.fun.estimated_pages_visited }}</div>
                        <div class="fun-stat-label">Estimated Pages Visited</div>
                    </div>
                </div>
                <div class="fun-stat-card">
                    <div class="fun-stat-icon">üìú</div>
                    <div class="fun-stat-content">
                        <div class="fun-stat-value">~{{ stats.fun.estimated_scroll_miles }} mi</div>
                        <div class="fun-stat-label">Miles Scrolled</div>
                        <div class="fun-stat-detail">That's {{ (stats.fun.estimated_scroll_miles * 5280)|int }} feet of scrolling!</div>
                    </div>
                </div>
                <div class="fun-stat-card">
                    <div class="fun-stat-icon">‚òï</div>
                    <div class="fun-stat-content">
                        <div class="fun-stat-value">~{{ stats.fun.coffee_cups_equivalent }}</div>
                        <div class="fun-stat-label">Coffee Cups Worth of Work</div>
                        <div class="fun-stat-detail">Based on 5 items per coffee</div>
                    </div>
                </div>
                <div class="fun-stat-card">
                    <div class="fun-stat-icon">üî•</div>
                    <div class="fun-stat-content">
                        <div class="fun-stat-value">{{ stats.account.days_active }}</div>
                        <div class="fun-stat-label">Day Contribution Streak</div>
                        <div class="fun-stat-detail">Keep it up!</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Account Info Footer -->
    <div class="stats-footer">
        <div class="stats-footer-item">
            <span class="footer-label">Member Since:</span>
            <span class="footer-value">{{ stats.account.member_since[:10] if stats.account.member_since else 'N/A' }}</span>
        </div>
        <div class="stats-footer-item">
            <span class="footer-label">Last Login:</span>
            <span class="footer-value">{{ stats.account.last_login[:16]|replace('T', ' ') if stats.account.last_login else 'N/A' }}</span>
        </div>
    </div>
</div>

<style>
/* User Statistics Page Styles */
.stats-page {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem;
}

.stats-header {
    text-align: center;
    margin-bottom: 2rem;
}

.stats-header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.stats-subtitle {
    color: var(--color-text-secondary);
    font-size: 1rem;
}

/* Highlight Cards Row */
.stats-highlight-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stats-highlight-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--color-bg-primary);
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    transition: transform 0.2s;
}

.stats-highlight-card:hover {
    transform: translateY(-2px);
}

.highlight-icon {
    font-size: 2.5rem;
    line-height: 1;
}

.highlight-value {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1.2;
}

.highlight-label {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
}

.stats-highlight-primary { border-left: 4px solid var(--color-primary); }
.stats-highlight-success { border-left: 4px solid var(--color-success); }
.stats-highlight-info { border-left: 4px solid var(--color-info); }
.stats-highlight-secondary { border-left: 4px solid var(--color-secondary); }

/* Stats Grid Sections */
.stats-grid-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
}

.stats-section {
    background: var(--color-bg-primary);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--shadow);
}

.stats-section h2 {
    font-size: 1.1rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-badge {
    font-size: 0.7rem;
    font-weight: 500;
    background: var(--color-primary);
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
}

.subsection-title {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin: 1rem 0 0.75rem;
}

/* Mini Stats Grid */
.stats-mini-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 0.75rem;
}

.stats-mini-grid-2 {
    grid-template-columns: repeat(2, 1fr);
}

.stats-mini-grid-3 {
    grid-template-columns: repeat(3, 1fr);
}

.stat-mini-card {
    text-align: center;
    padding: 1rem 0.5rem;
    background: var(--color-bg-secondary);
    border-radius: var(--border-radius-sm);
    transition: transform 0.2s;
}

.stat-mini-card:hover {
    transform: scale(1.02);
}

.stat-mini-icon {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
}

.stat-mini-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
}

.stat-mini-label {
    font-size: 0.75rem;
    color: var(--color-text-secondary);
    margin-top: 0.25rem;
}

.stat-card-success { background: rgba(40, 167, 69, 0.1); }
.stat-card-success .stat-mini-value { color: var(--color-success); }

.stat-card-warning { background: rgba(255, 193, 7, 0.15); }
.stat-card-warning .stat-mini-value { color: #d39e00; }

.stat-card-info { background: rgba(23, 162, 184, 0.1); }
.stat-card-info .stat-mini-value { color: var(--color-info); }

.stat-card-hot { 
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 193, 7, 0.1));
}
.stat-card-hot .stat-mini-value { color: #ff6b35; }

/* Performance Stats */
.performance-stats {
    display: flex;
    align-items: center;
    gap: 2rem;
}

.performance-main {
    flex-shrink: 0;
}

.performance-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-secondary);
    border: 4px solid var(--color-primary);
}

.performance-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--color-primary);
}

.performance-label {
    font-size: 0.7rem;
    color: var(--color-text-secondary);
    text-transform: uppercase;
}

.performance-breakdown {
    flex-grow: 1;
}

.breakdown-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--color-border);
}

.breakdown-item:last-child {
    border-bottom: none;
}

.breakdown-label {
    color: var(--color-text-secondary);
}

.breakdown-value {
    font-weight: 600;
}

.breakdown-success .breakdown-value { color: var(--color-success); }
.breakdown-danger .breakdown-value { color: var(--color-error); }

/* Fun Stats Section */
.stats-section-fun {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

/* QR Code Stats */
.qr-stat-highlight {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(0, 120, 212, 0.1), rgba(92, 107, 192, 0.1));
    border-radius: var(--border-radius);
    border: 1px solid rgba(0, 120, 212, 0.2);
}

.qr-stat-icon {
    line-height: 1;
}

.qr-stat-icon img {
    width: 48px;
    height: 48px;
}

.section-icon {
    width: 20px;
    height: 20px;
    vertical-align: middle;
    margin-right: 0.5rem;
}

.qr-stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--color-primary);
    line-height: 1.2;
}

.qr-stat-label {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-top: 0.25rem;
}

.fun-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.fun-stat-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--color-bg-primary);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
}

.fun-stat-icon {
    font-size: 2rem;
}

.fun-stat-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-primary);
}

.fun-stat-label {
    font-size: 0.8rem;
    color: var(--color-text-secondary);
}

.fun-stat-detail {
    font-size: 0.7rem;
    color: var(--color-text-muted);
    font-style: italic;
}

/* Footer */
.stats-footer {
    display: flex;
    justify-content: center;
    gap: 3rem;
    margin-top: 2rem;
    padding: 1rem;
    background: var(--color-bg-primary);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}

.stats-footer-item {
    text-align: center;
}

.footer-label {
    font-size: 0.75rem;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    display: block;
}

.footer-value {
    font-weight: 600;
}

/* Responsive */
@media (max-width: 768px) {
    .stats-highlight-row {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .stats-grid-sections {
        grid-template-columns: 1fr;
    }
    
    .performance-stats {
        flex-direction: column;
    }
    
    .stats-footer {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>
{% endblock %}
