{% extends "base.html" %}

{% block title %}{{ computer.nickname or computer.computer_name }} - Computer - PyBirch Database{% endblock %}

{% block content %}
<div class="detail-page">
    <div class="page-header">
        <div class="breadcrumb">
            <a href="{{ url_for('main.computers') }}">Computers</a> / {{ computer.nickname or computer.computer_name }}
        </div>
    </div>
    
    <div class="detail-header">
        <h1>{{ computer.nickname or computer.computer_name }}</h1>
        <div class="detail-actions">
            <a href="{{ url_for('main.computer_edit', computer_id=computer.id) }}" class="btn btn-secondary">Edit</a>
            <button class="btn btn-danger" onclick="moveToTrash('computer', {{ computer.id }}, '{{ (computer.nickname or computer.computer_name) | e }}')">üóëÔ∏è Move to Trash</button>
        </div>
    </div>
    
    {% if computer.description %}
    <div class="description-section">
        <p>{{ computer.description }}</p>
    </div>
    {% endif %}
    
    <div class="detail-grid">
        <div class="detail-section">
            <h2>Computer Information</h2>
            <dl class="detail-list">
                <dt>Hostname</dt>
                <dd><code>{{ computer.computer_name }}</code></dd>
                
                <dt>Nickname</dt>
                <dd>{{ computer.nickname or '-' }}</dd>
                
                <dt>Computer ID</dt>
                <dd>{{ computer.computer_id or '-' }}</dd>
                
                <dt>Location</dt>
                <dd>{{ computer.location or '-' }}</dd>
                
                <dt>Lab</dt>
                <dd>
                    {% if computer.lab_id and computer.lab_name %}
                    <a href="{{ url_for('main.lab_detail', lab_id=computer.lab_id) }}">{{ computer.lab_name }}</a>
                    {% else %}
                    -
                    {% endif %}
                </dd>
                
                <dt>Created</dt>
                <dd>{{ computer.created_at[:10] if computer.created_at else '-' }}</dd>
                
                <dt>Last Updated</dt>
                <dd>{{ computer.updated_at[:10] if computer.updated_at else '-' }}</dd>
            </dl>
        </div>
    </div>
    
    <!-- Instrument Bindings Section -->
    <div class="detail-section full-width">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div>
                <h2 style="margin: 0;">Bound Instruments</h2>
                <p class="section-description" style="margin: 4px 0 0 0;">Instruments that are connected to this computer.</p>
            </div>
            <a href="{{ url_for('main.computer_binding_new', computer_id=computer.id) }}" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                Add Binding
            </a>
        </div>
        
        {% if computer.bindings %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>Instrument</th>
                    <th>Definition</th>
                    <th>Adapter</th>
                    <th>Type</th>
                    <th>Primary</th>
                    <th>Last Connected</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for binding in computer.bindings %}
                <tr>
                    <td>
                        <a href="{{ url_for('main.instrument_detail', instrument_id=binding.instrument_id) }}">
                            {{ binding.instrument_name or 'Instrument #' ~ binding.instrument_id }}
                        </a>
                        {% if binding.instrument_status %}
                        <span class="status-badge status-{{ binding.instrument_status }}">{{ binding.instrument_status }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if binding.definition_name %}
                        {{ binding.definition_name }}
                        {% if binding.pybirch_class %}
                        <br><code class="small">{{ binding.pybirch_class }}</code>
                        {% endif %}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td><code>{{ binding.adapter or '-' }}</code></td>
                    <td>{{ binding.adapter_type or '-' }}</td>
                    <td>
                        {% if binding.is_primary %}
                        <span class="badge badge-success">Primary</span>
                        {% else %}
                        <span class="badge badge-secondary">Secondary</span>
                        {% endif %}
                    </td>
                    <td>{{ binding.last_connected[:10] if binding.last_connected else '-' }}</td>
                    <td>
                        <a href="{{ url_for('main.computer_binding_edit', computer_id=computer.id, binding_id=binding.id) }}" 
                           class="btn btn-sm btn-secondary" title="Edit binding">Edit</a>
                        <form action="{{ url_for('main.instrument_binding_delete', instrument_id=binding.instrument_id, binding_id=binding.id) }}" 
                              method="POST" style="display:inline;"
                              onsubmit="return confirm('Remove this binding?');">
                            <button type="submit" class="btn btn-sm btn-danger">Remove</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">No instruments are bound to this computer.</p>
        <p class="text-muted">Instruments can be bound from their detail page or when creating/editing an instrument.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
