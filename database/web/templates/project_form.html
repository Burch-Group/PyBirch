{% extends "base.html" %}

{% block title %}{% if project %}Edit Project{% else %}New Project{% endif %} - PyBirch Database{% endblock %}

{% block content %}
<div class="form-page">
    <div class="page-header">
        <div class="breadcrumb">
            <a href="{{ url_for('main.projects') }}">Projects</a> / {% if project %}Edit{{ else }}New{% endif %}
        </div>
    </div>
    
    <h1>{% if project %}Edit Project{% else %}New Project{% endif %}</h1>
    
    <form method="POST" class="data-form">
        <div class="form-section">
            <h2>Basic Information</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Project Name *</label>
                    <input type="text" id="name" name="name" value="{{ project.name if project else '' }}" required>
                </div>
                
                <div class="form-group">
                    <label for="code">Project Code</label>
                    <input type="text" id="code" name="code" value="{{ project.code if project else '' }}" placeholder="e.g., PRJ-2024-001">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="lab_id">Lab *</label>
                    <select id="lab_id" name="lab_id" class="searchable-select" data-entity-type="lab" required>
                        <option value="">-- Select Lab --</option>
                        {% for lab in labs %}
                        <option value="{{ lab.id }}" {% if project and project.lab_id == lab.id %}selected{% endif %}>{{ lab.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status">
                        <option value="planning" {% if project and project.status == 'planning' %}selected{% endif %}>Planning</option>
                        <option value="active" {% if project and project.status == 'active' %}selected{% elif not project %}selected{% endif %}>Active</option>
                        <option value="paused" {% if project and project.status == 'paused' %}selected{% endif %}>Paused</option>
                        <option value="completed" {% if project and project.status == 'completed' %}selected{% endif %}>Completed</option>
                        <option value="archived" {% if project and project.status == 'archived' %}selected{% endif %}>Archived</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" rows="4">{{ project.description if project else '' }}</textarea>
            </div>
            
            <div class="form-group">
                <label for="goals">Goals</label>
                <textarea id="goals" name="goals" rows="3">{{ project.goals if project else '' }}</textarea>
            </div>
        </div>
        
        <div class="form-section">
            <h2>Timeline</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start_date">Start Date</label>
                    <input type="date" id="start_date" name="start_date" value="{{ project.start_date if project else '' }}">
                </div>
                
                <div class="form-group">
                    <label for="end_date">End Date</label>
                    <input type="date" id="end_date" name="end_date" value="{{ project.end_date if project else '' }}">
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h2>Funding Information</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="funding_source">Funding Source</label>
                    <input type="text" id="funding_source" name="funding_source" value="{{ project.funding_source if project else '' }}" placeholder="e.g., NSF, DOE, NIH">
                </div>
                
                <div class="form-group">
                    <label for="grant_number">Grant Number</label>
                    <input type="text" id="grant_number" name="grant_number" value="{{ project.grant_number if project else '' }}">
                </div>
            </div>
            
            <div class="form-group half-width">
                <label for="budget">Budget ($)</label>
                <input type="number" id="budget" name="budget" step="0.01" min="0" value="{{ project.budget if project and project.budget else '' }}">
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{% if project %}Save Changes{% else %}Create Project{% endif %}</button>
            <a href="{{ url_for('main.projects') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

{% if not project %}
<script>
    // Autofill start date with current date for new projects
    document.addEventListener('DOMContentLoaded', function() {
        const startDateField = document.getElementById('start_date');
        if (startDateField && !startDateField.value) {
            const today = new Date().toISOString().split('T')[0];
            startDateField.value = today;
        }
    });
</script>
{% endif %}
{% endblock %}
