<!-- Object Location Section Component -->
<!-- Include this partial with: { % include 'partials/location_section.html' % } -->
<!-- Required variables: object_type, object_id, object_location (dict or None), locations_list (list for dropdown) -->
{% from "macros.html" import icon_edit, icon_trash, icon_view %}

<div class="detail-section location-section">
    <h2>üìç Location</h2>
    
    {% if object_location %}
    <div class="current-location">
        <dl class="detail-list">
            <dt>Current Location</dt>
            <dd>
                <a href="{{ url_for('main.location_detail', location_id=object_location.location_id) }}">
                    {{ object_location.location_name }}
                </a>
                {% if object_location.location_type %}
                <span class="type-badge" style="margin-left: 0.5rem;">{{ object_location.location_type }}</span>
                {% endif %}
            </dd>
            
            {% if object_location.notes %}
            <dt>Notes/Directions</dt>
            <dd>{{ object_location.notes }}</dd>
            {% endif %}
            
            <dt>Placed</dt>
            <dd>
                {{ object_location.placed_at[:10] if object_location.placed_at else '-' }}
                {% if object_location.placed_by %} by {{ object_location.placed_by }}{% endif %}
            </dd>
        </dl>
        
        {% if current_user %}
        <div class="location-actions" style="margin-top: 1rem; display: flex; gap: 0.5rem;">
            <button type="button" class="btn btn-secondary btn-small" onclick="showChangeLocationForm()">
                Change Location
            </button>
            <form method="POST" action="{{ url_for('main.object_remove_location', object_type=object_type, object_id=object_id) }}" style="display: inline;">
                <button type="submit" class="btn btn-danger btn-small" onclick="return confirm('Remove this object from its current location?')">
                    Remove from Location
                </button>
            </form>
        </div>
        {% endif %}
    </div>
    
    {% if current_user %}
    <!-- Change Location Form (hidden by default) -->
    <div id="change-location-form" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
        <h3>Change Location</h3>
        <form method="POST" action="{{ url_for('main.object_set_location', object_type=object_type, object_id=object_id) }}" class="inline-form">
            <div class="form-grid" style="grid-template-columns: 1fr 1fr auto; gap: 0.5rem; align-items: end;">
                <div class="form-group" style="margin: 0;">
                    <label for="location-select" style="font-size: 0.85rem; margin-bottom: 0.25rem;">New Location</label>
                    <select name="location_id" required class="searchable-select" id="location-select" data-entity-type="location" style="width: 100%;">
                        <option value="">Select Location...</option>
                        {% for loc in locations_list %}
                        <option value="{{ loc.id }}">{{ loc.name }}{% if loc.location_type %} ({{ loc.location_type }}){% endif %}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group" style="margin: 0;">
                    <label for="location-notes" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Notes/Directions</label>
                    <input type="text" name="notes" id="location-notes" placeholder="e.g., 'top shelf'" class="filter-input" style="width: 100%;">
                </div>
                <div class="form-group" style="margin: 0;">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-link" onclick="hideChangeLocationForm()">Cancel</button>
                </div>
            </div>
        </form>
    </div>
    {% endif %}
    
    {% else %}
    <p class="empty-message">This item is not assigned to any location.</p>
    
    {% if current_user %}
    <!-- Add Location Form -->
    <div class="add-location-form" style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
        <h3>Add to Location</h3>
        <form method="POST" action="{{ url_for('main.object_set_location', object_type=object_type, object_id=object_id) }}" class="inline-form">
            <div class="form-grid" style="grid-template-columns: 1fr 1fr auto; gap: 0.5rem; align-items: end;">
                <div class="form-group" style="margin: 0;">
                    <label for="location-select-new" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Location</label>
                    <select name="location_id" required class="searchable-select" id="location-select-new" data-entity-type="location" style="width: 100%;">
                        <option value="">Select Location...</option>
                        {% for loc in locations_list %}
                        <option value="{{ loc.id }}">{{ loc.name }}{% if loc.location_type %} ({{ loc.location_type }}){% endif %}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group" style="margin: 0;">
                    <label for="location-notes-new" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Notes/Directions</label>
                    <input type="text" name="notes" id="location-notes-new" placeholder="e.g., 'top shelf'" class="filter-input" style="width: 100%;">
                </div>
                <div class="form-group" style="margin: 0;">
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </div>
        </form>
    </div>
    {% endif %}
    {% endif %}
</div>

<script>
function showChangeLocationForm() {
    document.getElementById('change-location-form').style.display = 'block';
}
function hideChangeLocationForm() {
    document.getElementById('change-location-form').style.display = 'none';
}
</script>
