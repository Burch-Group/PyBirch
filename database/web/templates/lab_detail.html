{% extends "base.html" %}

{% block title %}{{ lab.name }} - PyBirch Database{% endblock %}

{% block content %}
<div class="detail-page">
    <div class="page-header">
        <div class="breadcrumb">
            <a href="{{ url_for('main.labs') }}">Labs</a> / {{ lab.name }}
        </div>
    </div>
    
    <div class="detail-header">
        <h1>{{ lab.name }}</h1>
        <div class="detail-actions">
            {% if lab.code %}
            <span class="badge badge-lg">{{ lab.code }}</span>
            {% endif %}
            <a href="{{ url_for('main.lab_edit', lab_id=lab.id) }}" class="btn btn-secondary">Edit</a>
            {% if current_user and current_user.role == 'admin' %}
            <form action="{{ url_for('main.lab_delete', lab_id=lab.id) }}" method="POST" style="display: inline;">
                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this lab? This action cannot be undone.')">Delete</button>
            </form>
            {% endif %}
        </div>
    </div>
    
    <div class="detail-grid">
        <div class="detail-section">
            <h2>Lab Information</h2>
            <dl class="detail-list">
                <dt>University</dt>
                <dd>{{ lab.university or '-' }}</dd>
                
                <dt>Department</dt>
                <dd>{{ lab.department or '-' }}</dd>
                
                <dt>Email</dt>
                <dd>{% if lab.email %}<a href="mailto:{{ lab.email }}">{{ lab.email }}</a>{% else %}-{% endif %}</dd>
                
                <dt>Phone</dt>
                <dd>{{ lab.phone or '-' }}</dd>
                
                <dt>Website</dt>
                <dd>{% if lab.website %}<a href="{{ lab.website }}" target="_blank">{{ lab.website }}</a>{% else %}-{% endif %}</dd>
                
                <dt>Address</dt>
                <dd>{{ lab.address or '-' }}</dd>
            </dl>
            
            {% if lab.description %}
            <h3>Description</h3>
            <p>{{ lab.description }}</p>
            {% endif %}
        </div>
        
        <div class="detail-section">
            <h2>Members ({{ lab.members|length }})</h2>
            <div class="section-actions">
                <a href="{{ url_for('main.lab_member_add', lab_id=lab.id) }}" class="btn btn-sm btn-primary">+ Add Member</a>
            </div>
            
            {% if lab.members %}
            <div class="member-list">
                {% for member in lab.members %}
                <div class="member-card">
                    <div class="member-info">
                        <strong>{{ member.name }}</strong>
                        <span class="role-badge role-{{ member.role }}">{{ member.role|replace('_', ' ')|title }}</span>
                        {% if member.title %}
                        <span class="member-title">{{ member.title }}</span>
                        {% endif %}
                    </div>
                    <div class="member-contact">
                        {% if member.email %}
                        <a href="mailto:{{ member.email }}">{{ member.email }}</a>
                        {% endif %}
                    </div>
                    <div class="member-actions">
                        <a href="{{ url_for('main.lab_member_edit', lab_id=lab.id, member_id=member.id) }}" class="btn btn-sm">Edit</a>
                        <form action="{{ url_for('main.lab_member_remove', lab_id=lab.id, member_id=member.id) }}" method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Remove this member?')">Remove</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty-message">No members yet.</p>
            {% endif %}
        </div>
    </div>
    
    <div class="detail-section full-width">
        <h2>Projects ({{ lab.projects|length }})</h2>
        <div class="section-actions">
            <a href="{{ url_for('main.project_new') }}?lab_id={{ lab.id }}" class="btn btn-sm btn-primary">+ New Project</a>
            <a href="{{ url_for('main.projects') }}?lab_id={{ lab.id }}" class="btn btn-sm btn-secondary">View All</a>
        </div>
        
        {% if lab.projects %}
        <table class="data-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Code</th>
                    <th>Status</th>
                    <th>Start Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for project in lab.projects[:5] %}
                <tr>
                    <td><a href="{{ url_for('main.project_detail', project_id=project.id) }}">{{ project.name }}</a></td>
                    <td>{{ project.code or '-' }}</td>
                    <td><span class="status-badge status-{{ project.status }}">{{ project.status }}</span></td>
                    <td>{{ project.start_date or '-' }}</td>
                    <td>
                        <a href="{{ url_for('main.project_detail', project_id=project.id) }}" class="btn btn-sm">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="empty-message">No projects yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
